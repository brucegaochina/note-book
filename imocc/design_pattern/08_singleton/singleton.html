<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单例模式 | MRCODE-BOOK</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/note-book/favicon.ico">
    <link rel="manifest" href="/note-book/manifest.json">
    <meta name="description" content="用来记录工作和学习过程中的笔记，汇总成册方便查阅，类容涵盖各类技术，如：Java、Git、ElasticSearch、MyCat、设计模式、Gradle、Vue - mrcode.cn">
    
    <link rel="preload" href="/note-book/assets/css/0.styles.f6819672.css" as="style"><link rel="preload" href="/note-book/assets/js/app.59b42468.js" as="script"><link rel="preload" href="/note-book/assets/js/7.a393a8e7.js" as="script"><link rel="preload" href="/note-book/assets/js/48.0d24adba.js" as="script"><link rel="preload" href="/note-book/assets/js/104.308420f7.js" as="script"><link rel="prefetch" href="/note-book/assets/js/10.66a7f6d1.js"><link rel="prefetch" href="/note-book/assets/js/100.d036647a.js"><link rel="prefetch" href="/note-book/assets/js/101.23721996.js"><link rel="prefetch" href="/note-book/assets/js/102.0667e0f4.js"><link rel="prefetch" href="/note-book/assets/js/103.f9d5312e.js"><link rel="prefetch" href="/note-book/assets/js/105.6ffe65b5.js"><link rel="prefetch" href="/note-book/assets/js/106.543f2fa8.js"><link rel="prefetch" href="/note-book/assets/js/107.908ed58f.js"><link rel="prefetch" href="/note-book/assets/js/108.34b0254f.js"><link rel="prefetch" href="/note-book/assets/js/109.4f531c10.js"><link rel="prefetch" href="/note-book/assets/js/11.3854756f.js"><link rel="prefetch" href="/note-book/assets/js/110.ef5e3380.js"><link rel="prefetch" href="/note-book/assets/js/111.74f7694e.js"><link rel="prefetch" href="/note-book/assets/js/112.160cae8f.js"><link rel="prefetch" href="/note-book/assets/js/113.4315aefa.js"><link rel="prefetch" href="/note-book/assets/js/114.a96c7560.js"><link rel="prefetch" href="/note-book/assets/js/115.4bb2150f.js"><link rel="prefetch" href="/note-book/assets/js/116.3afcacab.js"><link rel="prefetch" href="/note-book/assets/js/117.3c8aa18b.js"><link rel="prefetch" href="/note-book/assets/js/118.230d221b.js"><link rel="prefetch" href="/note-book/assets/js/119.9a79eac0.js"><link rel="prefetch" href="/note-book/assets/js/12.a26d71f9.js"><link rel="prefetch" href="/note-book/assets/js/120.c84a7469.js"><link rel="prefetch" href="/note-book/assets/js/121.a3bfc924.js"><link rel="prefetch" href="/note-book/assets/js/122.ee66af06.js"><link rel="prefetch" href="/note-book/assets/js/123.df836c68.js"><link rel="prefetch" href="/note-book/assets/js/124.77e8e92f.js"><link rel="prefetch" href="/note-book/assets/js/125.11170b99.js"><link rel="prefetch" href="/note-book/assets/js/126.2df6fb84.js"><link rel="prefetch" href="/note-book/assets/js/127.5b90080a.js"><link rel="prefetch" href="/note-book/assets/js/128.7057ba06.js"><link rel="prefetch" href="/note-book/assets/js/129.e4bb22e9.js"><link rel="prefetch" href="/note-book/assets/js/13.97995ce1.js"><link rel="prefetch" href="/note-book/assets/js/130.52f8a9f4.js"><link rel="prefetch" href="/note-book/assets/js/131.4d8db00d.js"><link rel="prefetch" href="/note-book/assets/js/132.2f39e88e.js"><link rel="prefetch" href="/note-book/assets/js/133.10426b3a.js"><link rel="prefetch" href="/note-book/assets/js/134.d7557018.js"><link rel="prefetch" href="/note-book/assets/js/135.160fc2a8.js"><link rel="prefetch" href="/note-book/assets/js/136.532344a3.js"><link rel="prefetch" href="/note-book/assets/js/137.9b85194c.js"><link rel="prefetch" href="/note-book/assets/js/138.6ad531c9.js"><link rel="prefetch" href="/note-book/assets/js/139.48ee347e.js"><link rel="prefetch" href="/note-book/assets/js/14.ac140d65.js"><link rel="prefetch" href="/note-book/assets/js/140.c185d00d.js"><link rel="prefetch" href="/note-book/assets/js/141.230e8743.js"><link rel="prefetch" href="/note-book/assets/js/142.656c5f33.js"><link rel="prefetch" href="/note-book/assets/js/143.2b717361.js"><link rel="prefetch" href="/note-book/assets/js/144.79f0df01.js"><link rel="prefetch" href="/note-book/assets/js/145.ca310991.js"><link rel="prefetch" href="/note-book/assets/js/146.1fbcbe63.js"><link rel="prefetch" href="/note-book/assets/js/147.585241d4.js"><link rel="prefetch" href="/note-book/assets/js/148.6c7cf173.js"><link rel="prefetch" href="/note-book/assets/js/149.52d880e8.js"><link rel="prefetch" href="/note-book/assets/js/15.05301410.js"><link rel="prefetch" href="/note-book/assets/js/150.78680ea6.js"><link rel="prefetch" href="/note-book/assets/js/151.9c583145.js"><link rel="prefetch" href="/note-book/assets/js/152.43b94cf9.js"><link rel="prefetch" href="/note-book/assets/js/153.e8aad073.js"><link rel="prefetch" href="/note-book/assets/js/154.316ce230.js"><link rel="prefetch" href="/note-book/assets/js/155.21b9e53e.js"><link rel="prefetch" href="/note-book/assets/js/156.373d812f.js"><link rel="prefetch" href="/note-book/assets/js/157.d11b79d4.js"><link rel="prefetch" href="/note-book/assets/js/158.6bc9ae0c.js"><link rel="prefetch" href="/note-book/assets/js/159.8bd79ff7.js"><link rel="prefetch" href="/note-book/assets/js/16.19fb61c3.js"><link rel="prefetch" href="/note-book/assets/js/160.1ed04a51.js"><link rel="prefetch" href="/note-book/assets/js/161.c0abe73f.js"><link rel="prefetch" href="/note-book/assets/js/162.39b53109.js"><link rel="prefetch" href="/note-book/assets/js/163.fb3ea863.js"><link rel="prefetch" href="/note-book/assets/js/164.38e26692.js"><link rel="prefetch" href="/note-book/assets/js/165.d63f011b.js"><link rel="prefetch" href="/note-book/assets/js/166.70b0bf81.js"><link rel="prefetch" href="/note-book/assets/js/167.c1b42356.js"><link rel="prefetch" href="/note-book/assets/js/168.bdd81f75.js"><link rel="prefetch" href="/note-book/assets/js/169.42c77035.js"><link rel="prefetch" href="/note-book/assets/js/17.116927dd.js"><link rel="prefetch" href="/note-book/assets/js/170.f25fa82a.js"><link rel="prefetch" href="/note-book/assets/js/171.560b9429.js"><link rel="prefetch" href="/note-book/assets/js/172.3448b04c.js"><link rel="prefetch" href="/note-book/assets/js/173.a9c135a7.js"><link rel="prefetch" href="/note-book/assets/js/174.10d53dad.js"><link rel="prefetch" href="/note-book/assets/js/175.5a594f59.js"><link rel="prefetch" href="/note-book/assets/js/176.dca9ae61.js"><link rel="prefetch" href="/note-book/assets/js/177.7872456b.js"><link rel="prefetch" href="/note-book/assets/js/178.1ab6f6ae.js"><link rel="prefetch" href="/note-book/assets/js/179.5cec32f6.js"><link rel="prefetch" href="/note-book/assets/js/18.ea2a6288.js"><link rel="prefetch" href="/note-book/assets/js/180.4342cf43.js"><link rel="prefetch" href="/note-book/assets/js/181.e4a90585.js"><link rel="prefetch" href="/note-book/assets/js/182.4dbd4b50.js"><link rel="prefetch" href="/note-book/assets/js/183.c96c3481.js"><link rel="prefetch" href="/note-book/assets/js/184.52d01883.js"><link rel="prefetch" href="/note-book/assets/js/185.e1ad0ea9.js"><link rel="prefetch" href="/note-book/assets/js/186.53dcd36d.js"><link rel="prefetch" href="/note-book/assets/js/187.bdb403d4.js"><link rel="prefetch" href="/note-book/assets/js/188.250f3c23.js"><link rel="prefetch" href="/note-book/assets/js/189.207bf4b9.js"><link rel="prefetch" href="/note-book/assets/js/19.bdccf5c5.js"><link rel="prefetch" href="/note-book/assets/js/190.f3d13c8d.js"><link rel="prefetch" href="/note-book/assets/js/191.e1bb5971.js"><link rel="prefetch" href="/note-book/assets/js/192.ead19428.js"><link rel="prefetch" href="/note-book/assets/js/193.d9404b46.js"><link rel="prefetch" href="/note-book/assets/js/194.0031b92a.js"><link rel="prefetch" href="/note-book/assets/js/195.4cc7509d.js"><link rel="prefetch" href="/note-book/assets/js/196.9f8b5c73.js"><link rel="prefetch" href="/note-book/assets/js/197.4607366d.js"><link rel="prefetch" href="/note-book/assets/js/198.89d5f3ad.js"><link rel="prefetch" href="/note-book/assets/js/199.57cc8386.js"><link rel="prefetch" href="/note-book/assets/js/2.db06f681.js"><link rel="prefetch" href="/note-book/assets/js/20.8641fa14.js"><link rel="prefetch" href="/note-book/assets/js/200.4521852f.js"><link rel="prefetch" href="/note-book/assets/js/201.713eaa55.js"><link rel="prefetch" href="/note-book/assets/js/202.237a7379.js"><link rel="prefetch" href="/note-book/assets/js/203.f1c0ad30.js"><link rel="prefetch" href="/note-book/assets/js/204.5da362ae.js"><link rel="prefetch" href="/note-book/assets/js/205.06b74aa1.js"><link rel="prefetch" href="/note-book/assets/js/206.b6736a74.js"><link rel="prefetch" href="/note-book/assets/js/207.c1e26a5c.js"><link rel="prefetch" href="/note-book/assets/js/208.4292529c.js"><link rel="prefetch" href="/note-book/assets/js/209.6b8bc47e.js"><link rel="prefetch" href="/note-book/assets/js/21.fcdba9a3.js"><link rel="prefetch" href="/note-book/assets/js/210.f2a522fe.js"><link rel="prefetch" href="/note-book/assets/js/211.462aa6bb.js"><link rel="prefetch" href="/note-book/assets/js/212.67d7bb06.js"><link rel="prefetch" href="/note-book/assets/js/213.7f4ad25f.js"><link rel="prefetch" href="/note-book/assets/js/214.4f978d81.js"><link rel="prefetch" href="/note-book/assets/js/215.3ddba5b2.js"><link rel="prefetch" href="/note-book/assets/js/216.b08c08b4.js"><link rel="prefetch" href="/note-book/assets/js/217.bb3e45f8.js"><link rel="prefetch" href="/note-book/assets/js/218.ca3e8a9d.js"><link rel="prefetch" href="/note-book/assets/js/219.cc71962c.js"><link rel="prefetch" href="/note-book/assets/js/22.a3c5b242.js"><link rel="prefetch" href="/note-book/assets/js/220.6f5f5fd2.js"><link rel="prefetch" href="/note-book/assets/js/221.65643d8d.js"><link rel="prefetch" href="/note-book/assets/js/222.c359bba0.js"><link rel="prefetch" href="/note-book/assets/js/223.a322e01a.js"><link rel="prefetch" href="/note-book/assets/js/224.6af9b4a7.js"><link rel="prefetch" href="/note-book/assets/js/225.29f1b071.js"><link rel="prefetch" href="/note-book/assets/js/226.0ac47068.js"><link rel="prefetch" href="/note-book/assets/js/227.4724351c.js"><link rel="prefetch" href="/note-book/assets/js/228.d3b365ca.js"><link rel="prefetch" href="/note-book/assets/js/229.99922dc8.js"><link rel="prefetch" href="/note-book/assets/js/23.006bb572.js"><link rel="prefetch" href="/note-book/assets/js/230.52f2de4b.js"><link rel="prefetch" href="/note-book/assets/js/231.6ca0bea9.js"><link rel="prefetch" href="/note-book/assets/js/232.4efea1bc.js"><link rel="prefetch" href="/note-book/assets/js/233.b133b88e.js"><link rel="prefetch" href="/note-book/assets/js/234.51a5e089.js"><link rel="prefetch" href="/note-book/assets/js/235.39cd7f55.js"><link rel="prefetch" href="/note-book/assets/js/236.125603cc.js"><link rel="prefetch" href="/note-book/assets/js/237.bcfbf7a5.js"><link rel="prefetch" href="/note-book/assets/js/238.3a10f3b3.js"><link rel="prefetch" href="/note-book/assets/js/239.30da2378.js"><link rel="prefetch" href="/note-book/assets/js/24.abcbe7da.js"><link rel="prefetch" href="/note-book/assets/js/240.48d1ed85.js"><link rel="prefetch" href="/note-book/assets/js/241.b7940ebf.js"><link rel="prefetch" href="/note-book/assets/js/242.0c859b33.js"><link rel="prefetch" href="/note-book/assets/js/243.96dbaf3a.js"><link rel="prefetch" href="/note-book/assets/js/244.9b3eeb42.js"><link rel="prefetch" href="/note-book/assets/js/245.87038f0c.js"><link rel="prefetch" href="/note-book/assets/js/246.33642053.js"><link rel="prefetch" href="/note-book/assets/js/247.bd1caea4.js"><link rel="prefetch" href="/note-book/assets/js/248.e7b180ea.js"><link rel="prefetch" href="/note-book/assets/js/249.25745497.js"><link rel="prefetch" href="/note-book/assets/js/25.a4148559.js"><link rel="prefetch" href="/note-book/assets/js/250.42c228dc.js"><link rel="prefetch" href="/note-book/assets/js/251.adbb697c.js"><link rel="prefetch" href="/note-book/assets/js/252.b2193dab.js"><link rel="prefetch" href="/note-book/assets/js/253.15b03095.js"><link rel="prefetch" href="/note-book/assets/js/254.cd27e19b.js"><link rel="prefetch" href="/note-book/assets/js/255.fbd9c42c.js"><link rel="prefetch" href="/note-book/assets/js/256.9ba6d22d.js"><link rel="prefetch" href="/note-book/assets/js/257.65d8ff55.js"><link rel="prefetch" href="/note-book/assets/js/258.64cfbc92.js"><link rel="prefetch" href="/note-book/assets/js/259.882b3806.js"><link rel="prefetch" href="/note-book/assets/js/26.33ca9ed1.js"><link rel="prefetch" href="/note-book/assets/js/260.46c5eac4.js"><link rel="prefetch" href="/note-book/assets/js/261.bb9f0850.js"><link rel="prefetch" href="/note-book/assets/js/262.88bf0cbe.js"><link rel="prefetch" href="/note-book/assets/js/263.009d5bd8.js"><link rel="prefetch" href="/note-book/assets/js/264.54e0543c.js"><link rel="prefetch" href="/note-book/assets/js/265.a702d12d.js"><link rel="prefetch" href="/note-book/assets/js/266.dc11da64.js"><link rel="prefetch" href="/note-book/assets/js/267.fbd47d78.js"><link rel="prefetch" href="/note-book/assets/js/268.04a3cc2e.js"><link rel="prefetch" href="/note-book/assets/js/269.4c7ebab3.js"><link rel="prefetch" href="/note-book/assets/js/27.4b2a5731.js"><link rel="prefetch" href="/note-book/assets/js/270.2f423f67.js"><link rel="prefetch" href="/note-book/assets/js/271.2297124f.js"><link rel="prefetch" href="/note-book/assets/js/272.f5536e27.js"><link rel="prefetch" href="/note-book/assets/js/273.e0555882.js"><link rel="prefetch" href="/note-book/assets/js/274.94c8a9a3.js"><link rel="prefetch" href="/note-book/assets/js/275.c0d8432f.js"><link rel="prefetch" href="/note-book/assets/js/276.73ade9b5.js"><link rel="prefetch" href="/note-book/assets/js/277.abd6e83c.js"><link rel="prefetch" href="/note-book/assets/js/278.23febe63.js"><link rel="prefetch" href="/note-book/assets/js/279.5d3a3edb.js"><link rel="prefetch" href="/note-book/assets/js/28.89d95437.js"><link rel="prefetch" href="/note-book/assets/js/280.4755b703.js"><link rel="prefetch" href="/note-book/assets/js/281.7aa00ae0.js"><link rel="prefetch" href="/note-book/assets/js/282.ce87d9e1.js"><link rel="prefetch" href="/note-book/assets/js/283.49a4ee3c.js"><link rel="prefetch" href="/note-book/assets/js/284.afbe60b4.js"><link rel="prefetch" href="/note-book/assets/js/285.77a6a9c6.js"><link rel="prefetch" href="/note-book/assets/js/286.c75dac5e.js"><link rel="prefetch" href="/note-book/assets/js/287.428c2333.js"><link rel="prefetch" href="/note-book/assets/js/288.61f79b5a.js"><link rel="prefetch" href="/note-book/assets/js/289.54ab66bb.js"><link rel="prefetch" href="/note-book/assets/js/29.d1bb326f.js"><link rel="prefetch" href="/note-book/assets/js/290.19e91e68.js"><link rel="prefetch" href="/note-book/assets/js/291.27816888.js"><link rel="prefetch" href="/note-book/assets/js/292.cc32e6a3.js"><link rel="prefetch" href="/note-book/assets/js/293.193aeabc.js"><link rel="prefetch" href="/note-book/assets/js/294.50fc00a4.js"><link rel="prefetch" href="/note-book/assets/js/295.320bd2ff.js"><link rel="prefetch" href="/note-book/assets/js/296.ffad117b.js"><link rel="prefetch" href="/note-book/assets/js/297.6de5f9f9.js"><link rel="prefetch" href="/note-book/assets/js/298.d08475cb.js"><link rel="prefetch" href="/note-book/assets/js/299.1f0b6c6b.js"><link rel="prefetch" href="/note-book/assets/js/3.6200e01b.js"><link rel="prefetch" href="/note-book/assets/js/30.7aefed19.js"><link rel="prefetch" href="/note-book/assets/js/300.dd635e23.js"><link rel="prefetch" href="/note-book/assets/js/301.57a640d3.js"><link rel="prefetch" href="/note-book/assets/js/302.780ea1d0.js"><link rel="prefetch" href="/note-book/assets/js/303.9abec2c7.js"><link rel="prefetch" href="/note-book/assets/js/304.9bc56151.js"><link rel="prefetch" href="/note-book/assets/js/305.e60ec3b5.js"><link rel="prefetch" href="/note-book/assets/js/306.c5700ef2.js"><link rel="prefetch" href="/note-book/assets/js/307.e1dfdac7.js"><link rel="prefetch" href="/note-book/assets/js/308.9d6443f2.js"><link rel="prefetch" href="/note-book/assets/js/309.4753c15b.js"><link rel="prefetch" href="/note-book/assets/js/31.f2cb45d1.js"><link rel="prefetch" href="/note-book/assets/js/310.4f9473c5.js"><link rel="prefetch" href="/note-book/assets/js/311.d6aadd43.js"><link rel="prefetch" href="/note-book/assets/js/312.f6a3f0d8.js"><link rel="prefetch" href="/note-book/assets/js/313.381daed3.js"><link rel="prefetch" href="/note-book/assets/js/314.36a17d54.js"><link rel="prefetch" href="/note-book/assets/js/315.66eaac54.js"><link rel="prefetch" href="/note-book/assets/js/316.f93a7eec.js"><link rel="prefetch" href="/note-book/assets/js/317.7510084a.js"><link rel="prefetch" href="/note-book/assets/js/318.f2445a45.js"><link rel="prefetch" href="/note-book/assets/js/319.37f5906d.js"><link rel="prefetch" href="/note-book/assets/js/32.569a98b9.js"><link rel="prefetch" href="/note-book/assets/js/320.a318de05.js"><link rel="prefetch" href="/note-book/assets/js/321.8f97cabc.js"><link rel="prefetch" href="/note-book/assets/js/322.b8e9f145.js"><link rel="prefetch" href="/note-book/assets/js/323.735979ae.js"><link rel="prefetch" href="/note-book/assets/js/324.d27fa526.js"><link rel="prefetch" href="/note-book/assets/js/325.a56c1d68.js"><link rel="prefetch" href="/note-book/assets/js/326.ee93c3b4.js"><link rel="prefetch" href="/note-book/assets/js/327.2d544869.js"><link rel="prefetch" href="/note-book/assets/js/328.787d19fd.js"><link rel="prefetch" href="/note-book/assets/js/329.ec696459.js"><link rel="prefetch" href="/note-book/assets/js/33.3a3a87a4.js"><link rel="prefetch" href="/note-book/assets/js/330.1faf10bb.js"><link rel="prefetch" href="/note-book/assets/js/331.30c788e6.js"><link rel="prefetch" href="/note-book/assets/js/332.5520d2d8.js"><link rel="prefetch" href="/note-book/assets/js/333.255f09bf.js"><link rel="prefetch" href="/note-book/assets/js/334.1db71c4b.js"><link rel="prefetch" href="/note-book/assets/js/335.74365dc5.js"><link rel="prefetch" href="/note-book/assets/js/336.1cec9fc5.js"><link rel="prefetch" href="/note-book/assets/js/337.139755ea.js"><link rel="prefetch" href="/note-book/assets/js/338.8b6efe78.js"><link rel="prefetch" href="/note-book/assets/js/339.c399e7bb.js"><link rel="prefetch" href="/note-book/assets/js/34.6160f6b6.js"><link rel="prefetch" href="/note-book/assets/js/340.a1261f0d.js"><link rel="prefetch" href="/note-book/assets/js/341.2b15ec07.js"><link rel="prefetch" href="/note-book/assets/js/342.84c3b3ec.js"><link rel="prefetch" href="/note-book/assets/js/343.82d052ad.js"><link rel="prefetch" href="/note-book/assets/js/344.f3c07cb4.js"><link rel="prefetch" href="/note-book/assets/js/345.d8ee920f.js"><link rel="prefetch" href="/note-book/assets/js/346.26c30385.js"><link rel="prefetch" href="/note-book/assets/js/347.5d77462a.js"><link rel="prefetch" href="/note-book/assets/js/348.39e7ea64.js"><link rel="prefetch" href="/note-book/assets/js/349.3a4c4903.js"><link rel="prefetch" href="/note-book/assets/js/35.5f9b9971.js"><link rel="prefetch" href="/note-book/assets/js/350.0b2451f8.js"><link rel="prefetch" href="/note-book/assets/js/351.ba98c492.js"><link rel="prefetch" href="/note-book/assets/js/352.dddfc8ce.js"><link rel="prefetch" href="/note-book/assets/js/353.0061fccd.js"><link rel="prefetch" href="/note-book/assets/js/354.ce3c1007.js"><link rel="prefetch" href="/note-book/assets/js/355.9a8239df.js"><link rel="prefetch" href="/note-book/assets/js/356.f7e5195d.js"><link rel="prefetch" href="/note-book/assets/js/357.d811e585.js"><link rel="prefetch" href="/note-book/assets/js/358.d88b4c2c.js"><link rel="prefetch" href="/note-book/assets/js/359.989a4a7a.js"><link rel="prefetch" href="/note-book/assets/js/36.4f37aa01.js"><link rel="prefetch" href="/note-book/assets/js/360.8f92d18e.js"><link rel="prefetch" href="/note-book/assets/js/361.b0bee984.js"><link rel="prefetch" href="/note-book/assets/js/362.2dcce512.js"><link rel="prefetch" href="/note-book/assets/js/363.08a61e7d.js"><link rel="prefetch" href="/note-book/assets/js/364.3753956b.js"><link rel="prefetch" href="/note-book/assets/js/365.b38c569e.js"><link rel="prefetch" href="/note-book/assets/js/366.5698eb0f.js"><link rel="prefetch" href="/note-book/assets/js/367.a3c5ef7a.js"><link rel="prefetch" href="/note-book/assets/js/368.68b6041d.js"><link rel="prefetch" href="/note-book/assets/js/369.827e4bd0.js"><link rel="prefetch" href="/note-book/assets/js/37.35e994a9.js"><link rel="prefetch" href="/note-book/assets/js/370.353cc15e.js"><link rel="prefetch" href="/note-book/assets/js/371.b26a5ee8.js"><link rel="prefetch" href="/note-book/assets/js/372.6fb72a01.js"><link rel="prefetch" href="/note-book/assets/js/373.08f4e139.js"><link rel="prefetch" href="/note-book/assets/js/374.6b635c83.js"><link rel="prefetch" href="/note-book/assets/js/375.a29b1ddc.js"><link rel="prefetch" href="/note-book/assets/js/376.808b14ab.js"><link rel="prefetch" href="/note-book/assets/js/377.f1ac9bbf.js"><link rel="prefetch" href="/note-book/assets/js/378.2a5343c0.js"><link rel="prefetch" href="/note-book/assets/js/379.dfafbac4.js"><link rel="prefetch" href="/note-book/assets/js/38.0cb15dd1.js"><link rel="prefetch" href="/note-book/assets/js/380.af99edd0.js"><link rel="prefetch" href="/note-book/assets/js/381.394f9ff2.js"><link rel="prefetch" href="/note-book/assets/js/382.d3729a12.js"><link rel="prefetch" href="/note-book/assets/js/383.e28e4b03.js"><link rel="prefetch" href="/note-book/assets/js/384.823953fb.js"><link rel="prefetch" href="/note-book/assets/js/385.765b1e97.js"><link rel="prefetch" href="/note-book/assets/js/386.2e5d37c3.js"><link rel="prefetch" href="/note-book/assets/js/387.1d504ce3.js"><link rel="prefetch" href="/note-book/assets/js/388.472ad4aa.js"><link rel="prefetch" href="/note-book/assets/js/389.7ec063f4.js"><link rel="prefetch" href="/note-book/assets/js/39.6bacfb51.js"><link rel="prefetch" href="/note-book/assets/js/390.554820dc.js"><link rel="prefetch" href="/note-book/assets/js/391.d3718a14.js"><link rel="prefetch" href="/note-book/assets/js/392.da725b5b.js"><link rel="prefetch" href="/note-book/assets/js/393.df8340e4.js"><link rel="prefetch" href="/note-book/assets/js/394.54034c32.js"><link rel="prefetch" href="/note-book/assets/js/395.72f371ba.js"><link rel="prefetch" href="/note-book/assets/js/396.335ee030.js"><link rel="prefetch" href="/note-book/assets/js/397.a606970f.js"><link rel="prefetch" href="/note-book/assets/js/398.1a299857.js"><link rel="prefetch" href="/note-book/assets/js/399.a6f36bd7.js"><link rel="prefetch" href="/note-book/assets/js/4.a4d09b6c.js"><link rel="prefetch" href="/note-book/assets/js/40.11702011.js"><link rel="prefetch" href="/note-book/assets/js/400.b1da3d0a.js"><link rel="prefetch" href="/note-book/assets/js/401.0d127dc3.js"><link rel="prefetch" href="/note-book/assets/js/402.1535e548.js"><link rel="prefetch" href="/note-book/assets/js/403.91658fb3.js"><link rel="prefetch" href="/note-book/assets/js/404.595a0dce.js"><link rel="prefetch" href="/note-book/assets/js/405.32a9af51.js"><link rel="prefetch" href="/note-book/assets/js/406.10f9a8b3.js"><link rel="prefetch" href="/note-book/assets/js/407.4e16a130.js"><link rel="prefetch" href="/note-book/assets/js/408.928c5ca6.js"><link rel="prefetch" href="/note-book/assets/js/409.a512ddbf.js"><link rel="prefetch" href="/note-book/assets/js/41.1395d6f9.js"><link rel="prefetch" href="/note-book/assets/js/410.55cd93dd.js"><link rel="prefetch" href="/note-book/assets/js/411.98ae6bb2.js"><link rel="prefetch" href="/note-book/assets/js/412.f8b3f985.js"><link rel="prefetch" href="/note-book/assets/js/413.8f95d8b0.js"><link rel="prefetch" href="/note-book/assets/js/414.890d6916.js"><link rel="prefetch" href="/note-book/assets/js/415.190c3abf.js"><link rel="prefetch" href="/note-book/assets/js/416.675b5875.js"><link rel="prefetch" href="/note-book/assets/js/417.1dd7416e.js"><link rel="prefetch" href="/note-book/assets/js/418.b8d17f51.js"><link rel="prefetch" href="/note-book/assets/js/419.3ac709ff.js"><link rel="prefetch" href="/note-book/assets/js/42.b66bc14f.js"><link rel="prefetch" href="/note-book/assets/js/420.8a1b4df8.js"><link rel="prefetch" href="/note-book/assets/js/421.9e58e16f.js"><link rel="prefetch" href="/note-book/assets/js/422.6eea86dd.js"><link rel="prefetch" href="/note-book/assets/js/423.e5734cbf.js"><link rel="prefetch" href="/note-book/assets/js/424.30f938bd.js"><link rel="prefetch" href="/note-book/assets/js/425.a8b88340.js"><link rel="prefetch" href="/note-book/assets/js/426.d8b30f4e.js"><link rel="prefetch" href="/note-book/assets/js/427.caba511b.js"><link rel="prefetch" href="/note-book/assets/js/428.14863787.js"><link rel="prefetch" href="/note-book/assets/js/429.bd84fbf1.js"><link rel="prefetch" href="/note-book/assets/js/43.4d79d80f.js"><link rel="prefetch" href="/note-book/assets/js/430.a617d1be.js"><link rel="prefetch" href="/note-book/assets/js/431.f6b8b119.js"><link rel="prefetch" href="/note-book/assets/js/432.0b36dc46.js"><link rel="prefetch" href="/note-book/assets/js/433.dbbc37cf.js"><link rel="prefetch" href="/note-book/assets/js/434.dc64460e.js"><link rel="prefetch" href="/note-book/assets/js/435.80b6aa62.js"><link rel="prefetch" href="/note-book/assets/js/436.2873f2ba.js"><link rel="prefetch" href="/note-book/assets/js/437.0d2d7501.js"><link rel="prefetch" href="/note-book/assets/js/438.5eef4f6c.js"><link rel="prefetch" href="/note-book/assets/js/439.42b8e6ed.js"><link rel="prefetch" href="/note-book/assets/js/44.b61c0a1d.js"><link rel="prefetch" href="/note-book/assets/js/440.1e66c6de.js"><link rel="prefetch" href="/note-book/assets/js/441.3336372d.js"><link rel="prefetch" href="/note-book/assets/js/442.583e7baa.js"><link rel="prefetch" href="/note-book/assets/js/443.52e43e9e.js"><link rel="prefetch" href="/note-book/assets/js/444.b77f2238.js"><link rel="prefetch" href="/note-book/assets/js/445.f6657203.js"><link rel="prefetch" href="/note-book/assets/js/446.7a68db41.js"><link rel="prefetch" href="/note-book/assets/js/447.57d6a71f.js"><link rel="prefetch" href="/note-book/assets/js/448.61751b23.js"><link rel="prefetch" href="/note-book/assets/js/449.4f38ac9e.js"><link rel="prefetch" href="/note-book/assets/js/45.b3d402a7.js"><link rel="prefetch" href="/note-book/assets/js/450.5911472e.js"><link rel="prefetch" href="/note-book/assets/js/451.d2500cc9.js"><link rel="prefetch" href="/note-book/assets/js/452.05713d6f.js"><link rel="prefetch" href="/note-book/assets/js/453.21ab4af6.js"><link rel="prefetch" href="/note-book/assets/js/454.a2307595.js"><link rel="prefetch" href="/note-book/assets/js/455.683423b7.js"><link rel="prefetch" href="/note-book/assets/js/456.e40700bc.js"><link rel="prefetch" href="/note-book/assets/js/457.d1555e50.js"><link rel="prefetch" href="/note-book/assets/js/458.fb691100.js"><link rel="prefetch" href="/note-book/assets/js/459.40bcb292.js"><link rel="prefetch" href="/note-book/assets/js/46.6e0227f3.js"><link rel="prefetch" href="/note-book/assets/js/460.b113a8b0.js"><link rel="prefetch" href="/note-book/assets/js/461.00d97be6.js"><link rel="prefetch" href="/note-book/assets/js/462.5cece320.js"><link rel="prefetch" href="/note-book/assets/js/463.e8a89b10.js"><link rel="prefetch" href="/note-book/assets/js/464.c48f21f5.js"><link rel="prefetch" href="/note-book/assets/js/465.37007d50.js"><link rel="prefetch" href="/note-book/assets/js/466.987905ee.js"><link rel="prefetch" href="/note-book/assets/js/467.161b4955.js"><link rel="prefetch" href="/note-book/assets/js/468.2c5ec0b1.js"><link rel="prefetch" href="/note-book/assets/js/469.fdf03e5e.js"><link rel="prefetch" href="/note-book/assets/js/47.e1a22493.js"><link rel="prefetch" href="/note-book/assets/js/470.e46b6b74.js"><link rel="prefetch" href="/note-book/assets/js/471.1782faef.js"><link rel="prefetch" href="/note-book/assets/js/472.5a1cf8da.js"><link rel="prefetch" href="/note-book/assets/js/473.68151d57.js"><link rel="prefetch" href="/note-book/assets/js/474.b3b41127.js"><link rel="prefetch" href="/note-book/assets/js/475.2173e481.js"><link rel="prefetch" href="/note-book/assets/js/476.c2360590.js"><link rel="prefetch" href="/note-book/assets/js/477.3e628a02.js"><link rel="prefetch" href="/note-book/assets/js/478.e9244148.js"><link rel="prefetch" href="/note-book/assets/js/479.54405b8d.js"><link rel="prefetch" href="/note-book/assets/js/480.56e89859.js"><link rel="prefetch" href="/note-book/assets/js/481.a0dfbe43.js"><link rel="prefetch" href="/note-book/assets/js/482.026a7170.js"><link rel="prefetch" href="/note-book/assets/js/483.cb781402.js"><link rel="prefetch" href="/note-book/assets/js/484.f6a64818.js"><link rel="prefetch" href="/note-book/assets/js/485.b1dd6348.js"><link rel="prefetch" href="/note-book/assets/js/486.5ccb9f69.js"><link rel="prefetch" href="/note-book/assets/js/487.fe9f92ea.js"><link rel="prefetch" href="/note-book/assets/js/488.c6ac2b9c.js"><link rel="prefetch" href="/note-book/assets/js/489.c7ce8469.js"><link rel="prefetch" href="/note-book/assets/js/49.41d9af8e.js"><link rel="prefetch" href="/note-book/assets/js/490.6d82d0e7.js"><link rel="prefetch" href="/note-book/assets/js/491.c4080e6d.js"><link rel="prefetch" href="/note-book/assets/js/492.6b968e5b.js"><link rel="prefetch" href="/note-book/assets/js/493.29ed8818.js"><link rel="prefetch" href="/note-book/assets/js/494.bb0d74cc.js"><link rel="prefetch" href="/note-book/assets/js/495.db688ac0.js"><link rel="prefetch" href="/note-book/assets/js/496.c66041b3.js"><link rel="prefetch" href="/note-book/assets/js/497.48241bf1.js"><link rel="prefetch" href="/note-book/assets/js/498.0c8d06f4.js"><link rel="prefetch" href="/note-book/assets/js/499.b13ebe5e.js"><link rel="prefetch" href="/note-book/assets/js/5.be717251.js"><link rel="prefetch" href="/note-book/assets/js/50.63ffaa80.js"><link rel="prefetch" href="/note-book/assets/js/500.b64a2627.js"><link rel="prefetch" href="/note-book/assets/js/501.f8a76167.js"><link rel="prefetch" href="/note-book/assets/js/502.494d61ca.js"><link rel="prefetch" href="/note-book/assets/js/503.065465ea.js"><link rel="prefetch" href="/note-book/assets/js/504.26f3afe9.js"><link rel="prefetch" href="/note-book/assets/js/505.438ffca1.js"><link rel="prefetch" href="/note-book/assets/js/506.d6a85d9b.js"><link rel="prefetch" href="/note-book/assets/js/507.ae019d98.js"><link rel="prefetch" href="/note-book/assets/js/508.b9505823.js"><link rel="prefetch" href="/note-book/assets/js/509.625bb402.js"><link rel="prefetch" href="/note-book/assets/js/51.26c31c3a.js"><link rel="prefetch" href="/note-book/assets/js/510.9caed09d.js"><link rel="prefetch" href="/note-book/assets/js/511.991d4671.js"><link rel="prefetch" href="/note-book/assets/js/512.e894cdc2.js"><link rel="prefetch" href="/note-book/assets/js/513.18925a47.js"><link rel="prefetch" href="/note-book/assets/js/514.945c78a4.js"><link rel="prefetch" href="/note-book/assets/js/515.7ee094a5.js"><link rel="prefetch" href="/note-book/assets/js/516.d2f33f2e.js"><link rel="prefetch" href="/note-book/assets/js/517.d54e5dd9.js"><link rel="prefetch" href="/note-book/assets/js/518.259dd160.js"><link rel="prefetch" href="/note-book/assets/js/519.1c47cdc3.js"><link rel="prefetch" href="/note-book/assets/js/52.c9995e5b.js"><link rel="prefetch" href="/note-book/assets/js/520.9bddb8bd.js"><link rel="prefetch" href="/note-book/assets/js/521.9e2385f2.js"><link rel="prefetch" href="/note-book/assets/js/522.bd83a313.js"><link rel="prefetch" href="/note-book/assets/js/523.4e76ed91.js"><link rel="prefetch" href="/note-book/assets/js/524.ea31775c.js"><link rel="prefetch" href="/note-book/assets/js/525.c538d6bd.js"><link rel="prefetch" href="/note-book/assets/js/526.25ab521b.js"><link rel="prefetch" href="/note-book/assets/js/527.c1e9ea33.js"><link rel="prefetch" href="/note-book/assets/js/528.92a23415.js"><link rel="prefetch" href="/note-book/assets/js/529.60e9a885.js"><link rel="prefetch" href="/note-book/assets/js/53.6f9bac82.js"><link rel="prefetch" href="/note-book/assets/js/530.3141415e.js"><link rel="prefetch" href="/note-book/assets/js/531.c7b0fce0.js"><link rel="prefetch" href="/note-book/assets/js/532.4d4b10a7.js"><link rel="prefetch" href="/note-book/assets/js/533.b7a0be73.js"><link rel="prefetch" href="/note-book/assets/js/534.bf083c48.js"><link rel="prefetch" href="/note-book/assets/js/535.90969fd0.js"><link rel="prefetch" href="/note-book/assets/js/536.8ca12c38.js"><link rel="prefetch" href="/note-book/assets/js/537.fc766a67.js"><link rel="prefetch" href="/note-book/assets/js/538.51c5d5fb.js"><link rel="prefetch" href="/note-book/assets/js/539.1f083039.js"><link rel="prefetch" href="/note-book/assets/js/54.7aa7b6ef.js"><link rel="prefetch" href="/note-book/assets/js/540.dd47b949.js"><link rel="prefetch" href="/note-book/assets/js/541.9d5d0fa5.js"><link rel="prefetch" href="/note-book/assets/js/542.bfd362fc.js"><link rel="prefetch" href="/note-book/assets/js/543.90963ff5.js"><link rel="prefetch" href="/note-book/assets/js/544.73ab71f2.js"><link rel="prefetch" href="/note-book/assets/js/545.6973eddb.js"><link rel="prefetch" href="/note-book/assets/js/546.0821886d.js"><link rel="prefetch" href="/note-book/assets/js/547.b79fe58a.js"><link rel="prefetch" href="/note-book/assets/js/548.7f46782a.js"><link rel="prefetch" href="/note-book/assets/js/549.92a244de.js"><link rel="prefetch" href="/note-book/assets/js/55.afab8003.js"><link rel="prefetch" href="/note-book/assets/js/550.e1c4ea76.js"><link rel="prefetch" href="/note-book/assets/js/551.7eacd5c3.js"><link rel="prefetch" href="/note-book/assets/js/552.ac36bf53.js"><link rel="prefetch" href="/note-book/assets/js/553.dac5d29a.js"><link rel="prefetch" href="/note-book/assets/js/554.e2ccf802.js"><link rel="prefetch" href="/note-book/assets/js/555.08a9274a.js"><link rel="prefetch" href="/note-book/assets/js/556.2a5f9546.js"><link rel="prefetch" href="/note-book/assets/js/557.4c163046.js"><link rel="prefetch" href="/note-book/assets/js/558.b1cb3da7.js"><link rel="prefetch" href="/note-book/assets/js/559.f4e3cc85.js"><link rel="prefetch" href="/note-book/assets/js/56.741fc47c.js"><link rel="prefetch" href="/note-book/assets/js/560.ef9851de.js"><link rel="prefetch" href="/note-book/assets/js/561.3cce5224.js"><link rel="prefetch" href="/note-book/assets/js/562.bad46d8f.js"><link rel="prefetch" href="/note-book/assets/js/563.cf12299d.js"><link rel="prefetch" href="/note-book/assets/js/564.34ccd38b.js"><link rel="prefetch" href="/note-book/assets/js/565.eb1fdf7b.js"><link rel="prefetch" href="/note-book/assets/js/566.3f1d4981.js"><link rel="prefetch" href="/note-book/assets/js/567.56683a73.js"><link rel="prefetch" href="/note-book/assets/js/568.e1eafd5b.js"><link rel="prefetch" href="/note-book/assets/js/569.6da82029.js"><link rel="prefetch" href="/note-book/assets/js/57.729d46a8.js"><link rel="prefetch" href="/note-book/assets/js/570.5226f3ad.js"><link rel="prefetch" href="/note-book/assets/js/571.8c80369b.js"><link rel="prefetch" href="/note-book/assets/js/572.26d977e2.js"><link rel="prefetch" href="/note-book/assets/js/573.0eff1bbe.js"><link rel="prefetch" href="/note-book/assets/js/574.fd5bb953.js"><link rel="prefetch" href="/note-book/assets/js/575.d5960bd7.js"><link rel="prefetch" href="/note-book/assets/js/576.63af5185.js"><link rel="prefetch" href="/note-book/assets/js/577.89ac9901.js"><link rel="prefetch" href="/note-book/assets/js/578.7f5b8dff.js"><link rel="prefetch" href="/note-book/assets/js/579.dbed8ffe.js"><link rel="prefetch" href="/note-book/assets/js/58.ccbfc139.js"><link rel="prefetch" href="/note-book/assets/js/580.64186066.js"><link rel="prefetch" href="/note-book/assets/js/581.8e89d5bc.js"><link rel="prefetch" href="/note-book/assets/js/582.07228bb2.js"><link rel="prefetch" href="/note-book/assets/js/583.77788d34.js"><link rel="prefetch" href="/note-book/assets/js/584.993d4a16.js"><link rel="prefetch" href="/note-book/assets/js/585.50b3fdb0.js"><link rel="prefetch" href="/note-book/assets/js/586.a81b142d.js"><link rel="prefetch" href="/note-book/assets/js/587.fdf59213.js"><link rel="prefetch" href="/note-book/assets/js/588.663491ea.js"><link rel="prefetch" href="/note-book/assets/js/589.0091ffac.js"><link rel="prefetch" href="/note-book/assets/js/59.00fbc332.js"><link rel="prefetch" href="/note-book/assets/js/590.19bed452.js"><link rel="prefetch" href="/note-book/assets/js/591.a776d191.js"><link rel="prefetch" href="/note-book/assets/js/592.3787f254.js"><link rel="prefetch" href="/note-book/assets/js/593.d714093e.js"><link rel="prefetch" href="/note-book/assets/js/594.2f4ab5b5.js"><link rel="prefetch" href="/note-book/assets/js/595.b3ed861f.js"><link rel="prefetch" href="/note-book/assets/js/596.18598994.js"><link rel="prefetch" href="/note-book/assets/js/597.4c487354.js"><link rel="prefetch" href="/note-book/assets/js/598.f7c648e3.js"><link rel="prefetch" href="/note-book/assets/js/599.b1dae3a7.js"><link rel="prefetch" href="/note-book/assets/js/6.dcb12139.js"><link rel="prefetch" href="/note-book/assets/js/60.d55e5225.js"><link rel="prefetch" href="/note-book/assets/js/600.23ff6b9d.js"><link rel="prefetch" href="/note-book/assets/js/601.40d276b8.js"><link rel="prefetch" href="/note-book/assets/js/602.4ea0fcf8.js"><link rel="prefetch" href="/note-book/assets/js/603.f3bbeea2.js"><link rel="prefetch" href="/note-book/assets/js/604.10bdf357.js"><link rel="prefetch" href="/note-book/assets/js/605.13d54946.js"><link rel="prefetch" href="/note-book/assets/js/606.7a2dc4e1.js"><link rel="prefetch" href="/note-book/assets/js/607.92971a55.js"><link rel="prefetch" href="/note-book/assets/js/608.ad0820e5.js"><link rel="prefetch" href="/note-book/assets/js/609.f70c4cec.js"><link rel="prefetch" href="/note-book/assets/js/61.600e95a6.js"><link rel="prefetch" href="/note-book/assets/js/610.ca8c516b.js"><link rel="prefetch" href="/note-book/assets/js/611.2b464422.js"><link rel="prefetch" href="/note-book/assets/js/612.37b5a6d1.js"><link rel="prefetch" href="/note-book/assets/js/613.cd1827d6.js"><link rel="prefetch" href="/note-book/assets/js/614.1ccadb55.js"><link rel="prefetch" href="/note-book/assets/js/615.5082a393.js"><link rel="prefetch" href="/note-book/assets/js/616.f05d7585.js"><link rel="prefetch" href="/note-book/assets/js/617.2e441ff8.js"><link rel="prefetch" href="/note-book/assets/js/618.5a675efb.js"><link rel="prefetch" href="/note-book/assets/js/619.91fa6376.js"><link rel="prefetch" href="/note-book/assets/js/62.21442816.js"><link rel="prefetch" href="/note-book/assets/js/620.be09f624.js"><link rel="prefetch" href="/note-book/assets/js/621.e8bdbbf7.js"><link rel="prefetch" href="/note-book/assets/js/622.fa015701.js"><link rel="prefetch" href="/note-book/assets/js/623.07787235.js"><link rel="prefetch" href="/note-book/assets/js/624.5e59b4bb.js"><link rel="prefetch" href="/note-book/assets/js/625.81119fff.js"><link rel="prefetch" href="/note-book/assets/js/626.e4369b8e.js"><link rel="prefetch" href="/note-book/assets/js/627.9f9303f7.js"><link rel="prefetch" href="/note-book/assets/js/628.f87c6446.js"><link rel="prefetch" href="/note-book/assets/js/629.485151f9.js"><link rel="prefetch" href="/note-book/assets/js/63.c3274ce6.js"><link rel="prefetch" href="/note-book/assets/js/630.0e07e6c5.js"><link rel="prefetch" href="/note-book/assets/js/631.a83da9dd.js"><link rel="prefetch" href="/note-book/assets/js/632.fd506f8d.js"><link rel="prefetch" href="/note-book/assets/js/633.77bdd8a9.js"><link rel="prefetch" href="/note-book/assets/js/634.2618eb06.js"><link rel="prefetch" href="/note-book/assets/js/64.bc1fe802.js"><link rel="prefetch" href="/note-book/assets/js/65.d815db4e.js"><link rel="prefetch" href="/note-book/assets/js/66.273710ab.js"><link rel="prefetch" href="/note-book/assets/js/67.10bd6c1c.js"><link rel="prefetch" href="/note-book/assets/js/68.b3018348.js"><link rel="prefetch" href="/note-book/assets/js/69.82b1d933.js"><link rel="prefetch" href="/note-book/assets/js/70.cd7aca17.js"><link rel="prefetch" href="/note-book/assets/js/71.0c216828.js"><link rel="prefetch" href="/note-book/assets/js/72.7648bbbd.js"><link rel="prefetch" href="/note-book/assets/js/73.187db2cb.js"><link rel="prefetch" href="/note-book/assets/js/74.5917c3c5.js"><link rel="prefetch" href="/note-book/assets/js/75.96a6ff00.js"><link rel="prefetch" href="/note-book/assets/js/76.849e86d9.js"><link rel="prefetch" href="/note-book/assets/js/77.707a8cca.js"><link rel="prefetch" href="/note-book/assets/js/78.9e69a646.js"><link rel="prefetch" href="/note-book/assets/js/79.52458009.js"><link rel="prefetch" href="/note-book/assets/js/8.d23a582a.js"><link rel="prefetch" href="/note-book/assets/js/80.7b0816ce.js"><link rel="prefetch" href="/note-book/assets/js/81.ca0ab89c.js"><link rel="prefetch" href="/note-book/assets/js/82.a6aee155.js"><link rel="prefetch" href="/note-book/assets/js/83.d62d4f45.js"><link rel="prefetch" href="/note-book/assets/js/84.62e47bf2.js"><link rel="prefetch" href="/note-book/assets/js/85.6b500aa8.js"><link rel="prefetch" href="/note-book/assets/js/86.7361d6d9.js"><link rel="prefetch" href="/note-book/assets/js/87.4bedaa36.js"><link rel="prefetch" href="/note-book/assets/js/88.f35ae79c.js"><link rel="prefetch" href="/note-book/assets/js/89.5fa8d6a8.js"><link rel="prefetch" href="/note-book/assets/js/9.3acb321a.js"><link rel="prefetch" href="/note-book/assets/js/90.ebcdc5f8.js"><link rel="prefetch" href="/note-book/assets/js/91.64bef801.js"><link rel="prefetch" href="/note-book/assets/js/92.ffa1062b.js"><link rel="prefetch" href="/note-book/assets/js/93.94344c1c.js"><link rel="prefetch" href="/note-book/assets/js/94.a1173cef.js"><link rel="prefetch" href="/note-book/assets/js/95.12b6e2e6.js"><link rel="prefetch" href="/note-book/assets/js/96.e5eca209.js"><link rel="prefetch" href="/note-book/assets/js/97.955813c1.js"><link rel="prefetch" href="/note-book/assets/js/98.e0e560b7.js"><link rel="prefetch" href="/note-book/assets/js/99.abc7a112.js">
    <link rel="stylesheet" href="/note-book/assets/css/0.styles.f6819672.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-book/" class="home-link router-link-active"><img src="/note-book/mlogo.svg" alt="MRCODE-BOOK" class="logo"> <span class="site-name can-hide">MRCODE-BOOK</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-book/posts/" class="nav-link">
  博客（零散文章）
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计模式" class="dropdown-title"><span class="title">设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="设计模式" class="mobile-dropdown-title"><span class="title">设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-book/imocc/design_pattern/" class="nav-link router-link-active">
  设计模式（慕课）
</a></li><li class="dropdown-item"><!----> <a href="/note-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-book/elasticsearch-core/" class="nav-link">
  核心知识篇
</a></li><li class="dropdown-item"><!----> <a href="/note-book/elasticsearch-senior/" class="nav-link">
  高级知识篇
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-book/introduce/" class="nav-link">
  本笔记介绍
</a></li><li class="dropdown-item"><!----> <a href="https://zq99299.github.io/linux-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linux 基础篇
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/note-book/spring-cloud-tutorial/" class="nav-link">
  Spring Cloud
</a></li><li class="dropdown-item"><!----> <a href="/note-book/css-zxx/" class="nav-link">
  CSS 深入理解（张鑫旭）
</a></li><li class="dropdown-item"><!----> <a href="/note-book/regular/" class="nav-link">
  正则入门
</a></li><li class="dropdown-item"><h4>
          思路拓展
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/back-end-storage/" class="nav-link">
  后端存储实战
</a></li><li class="dropdown-subitem"><a href="/note-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-subitem"><a href="/note-book/oath2/" class="nav-link">
  Oath 2.0 实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Git
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/git/" class="nav-link">
  Git 零散知识
</a></li><li class="dropdown-subitem"><a href="/note-book/git-scm/" class="nav-link">
  Git 系统学习笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          Mycat
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/mycat/" class="nav-link">
  Mycat 1
</a></li><li class="dropdown-subitem"><a href="/note-book/mycat2/" class="nav-link">
  Mycat 2
</a></li></ul></li><li class="dropdown-item"><h4>
          笔记精选汇总
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://book.mrcode.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内镜像站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/note-book/posts-failure.html" class="nav-link">
  博客文章 /_posts/ 路径失效说明
</a></li></ul></div></div> <a href="https://github.com/zq99299/note-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-book/posts/" class="nav-link">
  博客（零散文章）
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计模式" class="dropdown-title"><span class="title">设计模式</span> <span class="arrow down"></span></button> <button type="button" aria-label="设计模式" class="mobile-dropdown-title"><span class="title">设计模式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-book/imocc/design_pattern/" class="nav-link router-link-active">
  设计模式（慕课）
</a></li><li class="dropdown-item"><!----> <a href="/note-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-book/elasticsearch-core/" class="nav-link">
  核心知识篇
</a></li><li class="dropdown-item"><!----> <a href="/note-book/elasticsearch-senior/" class="nav-link">
  高级知识篇
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/note-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note-book/introduce/" class="nav-link">
  本笔记介绍
</a></li><li class="dropdown-item"><!----> <a href="https://zq99299.github.io/linux-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linux 基础篇
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/note-book/spring-cloud-tutorial/" class="nav-link">
  Spring Cloud
</a></li><li class="dropdown-item"><!----> <a href="/note-book/css-zxx/" class="nav-link">
  CSS 深入理解（张鑫旭）
</a></li><li class="dropdown-item"><!----> <a href="/note-book/regular/" class="nav-link">
  正则入门
</a></li><li class="dropdown-item"><h4>
          思路拓展
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/back-end-storage/" class="nav-link">
  后端存储实战
</a></li><li class="dropdown-subitem"><a href="/note-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-subitem"><a href="/note-book/oath2/" class="nav-link">
  Oath 2.0 实战
</a></li></ul></li><li class="dropdown-item"><h4>
          Git
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/git/" class="nav-link">
  Git 零散知识
</a></li><li class="dropdown-subitem"><a href="/note-book/git-scm/" class="nav-link">
  Git 系统学习笔记
</a></li></ul></li><li class="dropdown-item"><h4>
          Mycat
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note-book/mycat/" class="nav-link">
  Mycat 1
</a></li><li class="dropdown-subitem"><a href="/note-book/mycat2/" class="nav-link">
  Mycat 2
</a></li></ul></li><li class="dropdown-item"><h4>
          笔记精选汇总
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://book.mrcode.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内镜像站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/note-book/posts-failure.html" class="nav-link">
  博客文章 /_posts/ 路径失效说明
</a></li></ul></div></div> <a href="https://github.com/zq99299/note-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/note-book/imocc/design_pattern/" aria-current="page" class="sidebar-link">JAVA设计模式精讲</a></li><li><a href="/note-book/imocc/design_pattern/01/" class="sidebar-link">课程导学</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>UML急速入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计原则</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>设计模式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note-book/imocc/design_pattern/04_simple_factory/simple_factory.html" class="sidebar-link">简单工厂</a></li><li><a href="/note-book/imocc/design_pattern/05_factory_method/factory_method.html" class="sidebar-link">工厂方法模式</a></li><li><a href="/note-book/imocc/design_pattern/06_abstract_factory/abstract_factory.html" class="sidebar-link">抽象工厂</a></li><li><a href="/note-book/imocc/design_pattern/07_builder/builder.html" class="sidebar-link">建造者模式</a></li><li><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html" aria-current="page" class="active sidebar-link">单例模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#适用场景" class="sidebar-link">适用场景</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#优缺点" class="sidebar-link">优缺点</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#重点" class="sidebar-link">重点</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#实用技能" class="sidebar-link">实用技能</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#相关的设计模式" class="sidebar-link">相关的设计模式</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#coding" class="sidebar-link">coding</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#懒汉式单例模式" class="sidebar-link">懒汉式单例模式</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#多线程-debug-教程" class="sidebar-link">多线程 debug 教程</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#懒汉式-synchronized" class="sidebar-link">懒汉式 - synchronized</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#懒汉式-内部类" class="sidebar-link">懒汉式 - 内部类</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#饿汉式" class="sidebar-link">饿汉式</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#破坏单例模式" class="sidebar-link">破坏单例模式</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#反射攻击解决方案及原理分析" class="sidebar-link">反射攻击解决方案及原理分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#类加载就初始化的单例模式" class="sidebar-link">类加载就初始化的单例模式</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#懒汉式防御解析" class="sidebar-link">懒汉式防御解析</a></li></ul></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#枚举单例模式" class="sidebar-link">枚举单例模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#枚举单例模式序列化攻击测试" class="sidebar-link">枚举单例模式序列化攻击测试</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#枚举反射攻击测试" class="sidebar-link">枚举反射攻击测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#反编译-jad-查看-class-文件" class="sidebar-link">反编译 - jad 查看 class 文件</a></li><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#枚举单例模式续" class="sidebar-link">枚举单例模式续</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-book/imocc/design_pattern/08_singleton/singleton.html#枚举类小结" class="sidebar-link">枚举类小结</a></li></ul></li></ul></li><li><a href="/note-book/imocc/design_pattern/08_singleton/singleton2.html" class="sidebar-link">单例模式2</a></li><li><a href="/note-book/imocc/design_pattern/09_prototype/prototype.html" class="sidebar-link">原型设计模式</a></li><li><a href="/note-book/imocc/design_pattern/10_facade/facade.html" class="sidebar-link">外观模式</a></li><li><a href="/note-book/imocc/design_pattern/11_decorator/decorator.html" class="sidebar-link">装饰者模式</a></li><li><a href="/note-book/imocc/design_pattern/12_adapter/adapter.html" class="sidebar-link">适配器模式</a></li><li><a href="/note-book/imocc/design_pattern/13_flyweight/flyweight.html" class="sidebar-link">享元模式 Flyweight</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h1> <blockquote><p>关联阅读 <a href="/note-book/design_pattern/06_singleton/singleton.html">李兴华-单例模式</a></p> <p>这一节的内容李兴华老师的课程就略显干货不足了。</p></blockquote> <p><strong>定义</strong>：保证一个类仅有一个实例，并提供一个全局访问点</p> <p><strong>类型</strong>：创建型</p> <h2 id="适用场景"><a href="#适用场景" class="header-anchor">#</a> 适用场景</h2> <p>想确保任何情况下都绝对只有一个实例</p> <h2 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h2> <p><strong>优点</strong>：</p> <ul><li>在内存里只有一个实例，减少了内存开销</li> <li>可以避免对资源的多重占用</li> <li>设置全局访问点，严格控制访问</li></ul> <p><strong>缺点</strong>：</p> <ul><li>没有接口，扩展困难</li></ul> <h2 id="重点"><a href="#重点" class="header-anchor">#</a> 重点</h2> <ul><li>私有构造器：防止在外部创建对象</li> <li>线程安全</li> <li>延迟加载：使用的时候才创建</li> <li>序列化和反序列化安全</li> <li>反射：防止反射攻击</li></ul> <h2 id="实用技能"><a href="#实用技能" class="header-anchor">#</a> 实用技能</h2> <ul><li>反编译</li> <li>内存原理</li> <li>多线程 Debug</li></ul> <h2 id="相关的设计模式"><a href="#相关的设计模式" class="header-anchor">#</a> 相关的设计模式</h2> <ul><li>单例模式和工厂模式</li> <li>单例模式和享元模式</li></ul> <h2 id="coding"><a href="#coding" class="header-anchor">#</a> coding</h2> <h2 id="懒汉式单例模式"><a href="#懒汉式单例模式" class="header-anchor">#</a> 懒汉式单例模式</h2> <p>线程不安全的懒汉式单例模式比较简单，两个要点：</p> <ol><li>私有构造</li> <li>内部持有一个实例，在访问的时候再初始化</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>newstudy<span class="token punctuation">.</span>design<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>creational<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>LazySingleton</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> lazySingleton <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lazySingleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lazySingleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> lazySingleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        LazySingleton instance = LazySingleton.getInstance();</span>
<span class="token comment">//        System.out.println(instance);</span>
        <span class="token comment">// 使用多线程来 演示 debug 怎么调试</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="多线程-debug-教程"><a href="#多线程-debug-教程" class="header-anchor">#</a> 多线程 debug 教程</h2> <p><img src="/note-book/assets/img/markdown-img-paste-20180927220918119.062ef8ae.png" alt=""></p> <p>先打上断点，然后在断点上右键，即可出现上图中的内容；选择 thread 方式，并设置为默认</p> <p><img src="/note-book/assets/img/markdown-img-paste-20180927222127272.d3fc9403.png" alt=""></p> <p>看上图，因为现在在 main 线程中，使用 debug 停留了。</p> <p>切换到 线程0 中，可以看到一直阻塞在这里的。这样一来多线程调试就更方便了</p> <p><img src="/note-book/assets/img/markdown-img-paste-20180927222157927.d07f0fc0.png" alt=""></p> <h2 id="懒汉式-synchronized"><a href="#懒汉式-synchronized" class="header-anchor">#</a> 懒汉式 - synchronized</h2> <p>保证线程安全最简单的就是加 synchronized 关键字；</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lazySingleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lazySingleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> lazySingleton<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但是这样会有一个问题，就是每个线程获取都会被阻塞。如果在一个很繁忙的系统中，这里的性能就大大降低了。</p> <p>可以使用双重检查来优化这个地方，实际上就是减少锁的粒度</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazyDoubleCheckSingleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LazyDoubleCheckSingleton</span> lazyDoubleCheckSingleton <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">LazyDoubleCheckSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazyDoubleCheckSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 第一层不加锁，有值则返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lazyDoubleCheckSingleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 假设有2个线程进入到这里在等待了</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">LazyDoubleCheckSingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 那么当第一个线程创建之后，其实是有值的了</span>
                <span class="token comment">// 所以这里还需要判定一下，有值则不创建了</span>
                <span class="token comment">// 所以这里是双重判定</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lazyDoubleCheckSingleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    lazyDoubleCheckSingleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyDoubleCheckSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 这里有一个内存可见性的问题</span>
                    <span class="token comment">// 上面这一句话其实分为三步</span>
                    <span class="token comment">// 1. 分配内存给这个对象</span>
                    <span class="token comment">// 2. 初始化对象</span>
                    <span class="token comment">// 3. 设置 lazyDoubleCheckSingleton 指向刚分配的内存</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> lazyDoubleCheckSingleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>对于这个内存可见性的问题。步骤 2 和步骤 3 可能被重排序。在多线程情况下，如果被重排序了</p> <p>那么在第一层判断的时候就会判断有值，但是实际上对象还未被初始化。</p> <p>？：我怎么记忆中是这里初始化了，因为内存可见性，其他线程会认为看不到已经改变</p> <p>也就是下图中描述的情况；</p> <p><img src="/note-book/assets/img/markdown-img-paste-20180927215712289.c6090dff.png" alt=""></p> <p><img src="/note-book/assets/img/markdown-img-paste-2018092722525135.ec5ae187.png" alt=""></p> <p>要解决这个问题：</p> <ol><li>volatile 变量：</li></ol> <p>对于一个 volatile 域的写，happens-before 于任意后续对这个 volatile 的读
但是，不保证写是原子的；
所以：这里使用 volatile 只是保证一个线程的写对另一个线程可见，加上 synchronized 保证写操作是原子的。在 synchronized 域中可重排序。但是在释放锁的时候，保证结果正确</p> <ol start="2"><li>禁止重排序：使用内部类，让 jvm 来保证两个操作直接的禁止重排</li></ol> <p>保证 lazyDoubleCheckSingleton 的可见性；给该变量加上 volatile 关键字即可；</p> <p>volatile ：会让其他 cpu 中缓存的数据失效，读取主存中的数据。即可保证内存对其他线程课件</p> <h2 id="懒汉式-内部类"><a href="#懒汉式-内部类" class="header-anchor">#</a> 懒汉式 - 内部类</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticInnerClassSingleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">InnerClass</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">StaticInnerClassSingleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticInnerClassSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StaticInnerClassSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">InnerClass</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>静态内部类很简单。下面代码来测试是否是延迟的情况</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticInnerClassSingleton</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;单例类初始化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">InnerClass</span> <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;内部类初始化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">StaticInnerClassSingleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticInnerClassSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;测试是否是延迟初始化的&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">StaticInnerClassSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">InnerClass</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>执行测试代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token class-name">StaticInnerClassSingleton</span> instance <span class="token operator">=</span> <span class="token class-name">StaticInnerClassSingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  输出：

  内部类初始化
  单例类初始化
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>执行测试代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">StaticInnerClassSingleton</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

输出

测试是否是延迟初始化的
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看到，只有在使用该实例的时候，才会被初始化，而这个初始化时 jvm 保证线程安全性的；</p> <p>原理是：</p> <p><img src="/note-book/assets/img/markdown-img-paste-20180927215721962.87f14bd0.png" alt=""></p> <p>在类初始化的时候 jvm 会获取一个初始化锁，保证多个线程对同一个对象的初始化安全问题</p> <p>这里有一个遗留问题：上面的代码中。没有对单例类私有构造。一定要加深认识</p> <h2 id="饿汉式"><a href="#饿汉式" class="header-anchor">#</a> 饿汉式</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HungrySingleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton</span> hungrySingleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> hungrySingleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在类加载的时候完成赋值；</p> <p>在之前差不多把单例模式修补得比较完善了，现在来破坏单例模式。</p> <h2 id="破坏单例模式"><a href="#破坏单例模式" class="header-anchor">#</a> 破坏单例模式</h2> <p>使用序列化，再反序列化，那么这个对象还是之前的那个对象吗？</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
    <span class="token class-name">HungrySingleton</span> instance <span class="token operator">=</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 序列化到文件</span>
    <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;HungrySingleton&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 从文件读取出来</span>

    <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;HungrySingleton&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HungrySingleton</span> instanceFromFile <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HungrySingleton</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instanceFromFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> instanceFromFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>输出</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>newstudy<span class="token punctuation">.</span>design<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>creational<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>HungrySingleton</span><span class="token annotation punctuation">@7494e528</span>
<span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>newstudy<span class="token punctuation">.</span>design<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>creational<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>HungrySingleton</span><span class="token annotation punctuation">@7d0587f1</span>
<span class="token boolean">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>那么怎么破解这个问题呢？很简单在单例类中增加一个方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> hungrySingleton<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>原理是什么呢？这个要看源码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span>#readObject
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span>#readObject0

<span class="token keyword">case</span> TC_OBJECT<span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token function">checkResolve</span><span class="token punctuation">(</span><span class="token function">readOrdinaryObject</span><span class="token punctuation">(</span>unshared<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

找到这一行。继续跟踪

<span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readOrdinaryObject</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> unshared<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">IOException</span>
  <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>bin<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> TC_OBJECT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InternalError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token class-name">ObjectStreamClass</span> desc <span class="token operator">=</span> <span class="token function">readClassDesc</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      desc<span class="token punctuation">.</span><span class="token function">checkDeserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> cl <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cl <span class="token operator">==</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token operator">||</span> cl <span class="token operator">==</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span>
              <span class="token operator">||</span> cl <span class="token operator">==</span> <span class="token class-name">ObjectStreamClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">&quot;invalid class descriptor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token class-name">Object</span> obj<span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// 首先先通过反射创建实例</span>
          <span class="token comment">// 当实现了 serializable/externalizable 接口的时候，则返回 true</span>
          obj <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">isInstantiable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> desc<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span>
              desc<span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token string">&quot;unable to create instance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initCause</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      passHandle <span class="token operator">=</span> handles<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>unshared <span class="token operator">?</span> unsharedMarker <span class="token operator">:</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">ClassNotFoundException</span> resolveEx <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">getResolveException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>resolveEx <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          handles<span class="token punctuation">.</span><span class="token function">markException</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">,</span> resolveEx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">isExternalizable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">readExternalData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Externalizable</span><span class="token punctuation">)</span> obj<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">readSerialData</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      handles<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 这里再判定 是否有读解析方法</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
          handles<span class="token punctuation">.</span><span class="token function">lookupException</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
          desc<span class="token punctuation">.</span><span class="token function">hasReadResolveMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token class-name">Object</span> rep <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">invokeReadResolve</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>unshared <span class="token operator">&amp;&amp;</span> rep<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              rep <span class="token operator">=</span> <span class="token function">cloneArray</span><span class="token punctuation">(</span>rep<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>rep <span class="token operator">!=</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              handles<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>passHandle<span class="token punctuation">,</span> obj <span class="token operator">=</span> rep<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 这里判定这个方法是否存在</span>
  <span class="token comment">// 也就是说，如果你中的类中定义了 readResolve 方法，那么将会调用该方法</span>
  <span class="token comment">// 也就是不允许外部实例化</span>
  <span class="token comment">// 这里一定要看注释，英文的也要认证翻译看。不然光看这个代码，是看不出来什么的</span>
  <span class="token keyword">boolean</span> <span class="token function">hasReadResolveMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>readResolveMethod <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/** class-defined readResolve method, or null if none */</span>
  <span class="token keyword">private</span> <span class="token class-name">Method</span> readResolveMethod<span class="token punctuation">;</span>

  <span class="token comment">// 可以搜索下这个变量在哪里赋值的,这里就可以看到了，定义了这么一个字符串，去查找这个方法</span>
  readResolveMethod <span class="token operator">=</span> <span class="token function">getInheritableMethod</span><span class="token punctuation">(</span>
                        cl<span class="token punctuation">,</span> <span class="token string">&quot;readResolve&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h2 id="反射攻击解决方案及原理分析"><a href="#反射攻击解决方案及原理分析" class="header-anchor">#</a> 反射攻击解决方案及原理分析</h2> <h3 id="类加载就初始化的单例模式"><a href="#类加载就初始化的单例模式" class="header-anchor">#</a> 类加载就初始化的单例模式</h3> <p>针对恶汉单例模式来测试，使用反射和正常获取实例的对比是否是同一个实例。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HungrySingleton</span><span class="token punctuation">&gt;</span></span> objectClass <span class="token operator">=</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HungrySingleton</span><span class="token punctuation">&gt;</span></span> constructor <span class="token operator">=</span> objectClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HungrySingleton</span> instance <span class="token operator">=</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// java.lang.IllegalAccessException: Class cn.mrcode.newstudy.design.pattern.creational.singleton.HungrySingletonTest can not access a member of class cn.mrcode.newstudy.design.pattern.creational.singleton.HungrySingleton with modifiers &quot;private&quot;</span>
    <span class="token comment">// 解决私有构造不能访问的限制</span>
    constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HungrySingleton</span> objectInstance <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>objectInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> objectInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>结果很明显，不是同一个。原因：</p> <ol><li>final static 修饰的是在<strong>类加载</strong>的时候完成的初始化</li> <li>这里反射是调用空参构造</li></ol> <p>所以这里出来的不是同一个对象。那么这里的防御攻击就很简单了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 在私有构造中判定一下即可</span>
<span class="token keyword">private</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hungrySingleton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;单例模式不允许使用反射创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="懒汉式防御解析"><a href="#懒汉式防御解析" class="header-anchor">#</a> 懒汉式防御解析</h3> <p>首先，结论是，懒汉式没有办法防御反射攻击。原因：使用的时候才会初始化，没有办法保证只初始化一次。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> lazySingleton <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lazySingleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lazySingleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> lazySingleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这里使用前面恶汉式的方式来演示之后就明白了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lazySingleton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;单例模式不允许使用反射创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>测试代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span> <span class="token punctuation">{</span>
    <span class="token class-name">LazySingleton</span> instance <span class="token operator">=</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LazySingleton</span><span class="token punctuation">&gt;</span></span> lazySingletonClass <span class="token operator">=</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LazySingleton</span><span class="token punctuation">&gt;</span></span> declaredConstructor <span class="token operator">=</span> lazySingletonClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LazySingleton</span> lazySingleton <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>lazySingleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> lazySingleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>现在这个测试代码是可以防御到的，因为先运行了 LazySingleton.getInstance()，
但是吧他们的顺序改变下，就不能防御了，或者是在多线程程序中也是不能防御的。</p> <p>问题根源就在于：如果先用反射创建，那么变量没有赋值。</p> <p>所以这里可以增加一个状态，来记录是否可以创建对象。当然这里只能限制只被执行一次</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 构造只能被调用一次</span>
        flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;单例模式不允许使用反射创建&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>测试代码可以使用上一次的，这里演示为什么说添加变量的方式也没有办法阻止。
因为变量也是成员，也可以通过反射的方式修改。下面演示</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchFieldException</span> <span class="token punctuation">{</span>
     <span class="token class-name">LazySingleton</span> instance <span class="token operator">=</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LazySingleton</span><span class="token punctuation">&gt;</span></span> lazySingletonClass <span class="token operator">=</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

     <span class="token comment">// 只是增加了这一段代码，把标志变量修改了</span>
     <span class="token class-name">Field</span> flag <span class="token operator">=</span> lazySingletonClass<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;flag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     flag<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     flag<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LazySingleton</span><span class="token punctuation">&gt;</span></span> declaredConstructor <span class="token operator">=</span> lazySingletonClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">LazySingleton</span> lazySingleton <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>lazySingleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> lazySingleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>通过实验得知：懒汉式的无法防止反射攻击。因为它不是类加载的时候被初始化，无法保证初始化顺序</p> <h2 id="枚举单例模式"><a href="#枚举单例模式" class="header-anchor">#</a> 枚举单例模式</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">EnumInstance</span> <span class="token punctuation">{</span>
    INSTANCE<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">EnumInstance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="枚举单例模式序列化攻击测试"><a href="#枚举单例模式序列化攻击测试" class="header-anchor">#</a> 枚举单例模式序列化攻击测试</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
    <span class="token class-name">EnumInstance</span> instance <span class="token operator">=</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    instance<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 序列化到文件</span>
    <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;EnumInstance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 从文件读取出来</span>

    <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;EnumInstance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EnumInstance</span> instanceFromFile <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EnumInstance</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instanceFromFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> instanceFromFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===== 查看实例里面的 变量是否是同一个&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instanceFromFile<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> instanceFromFile<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>这个是为什么呢? 源码会告诉我们答案</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span>#readObject  入口

找到读取枚举的地方
<span class="token keyword">case</span> TC_ENUM<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">checkResolve</span><span class="token punctuation">(</span><span class="token function">readEnum</span><span class="token punctuation">(</span>unshared<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span>#readEnum

<span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> cl <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">forClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
          <span class="token comment">// 直接通过名称和class获取的</span>
          <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> en <span class="token operator">=</span> <span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span>cl<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
          result <span class="token operator">=</span> en<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">InvalidObjectException</span><span class="token punctuation">(</span>
              <span class="token string">&quot;enum constant &quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot; does not exist in &quot;</span> <span class="token operator">+</span>
              cl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initCause</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>unshared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          handles<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span>enumHandle<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="枚举反射攻击测试"><a href="#枚举反射攻击测试" class="header-anchor">#</a> 枚举反射攻击测试</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 枚举反射攻击</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span> <span class="token punctuation">{</span>
      <span class="token class-name">EnumInstance</span> instance <span class="token operator">=</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnumInstance</span><span class="token punctuation">&gt;</span></span> enumInstanceClass <span class="token operator">=</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

      <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnumInstance</span><span class="token punctuation">&gt;</span></span> declaredConstructor <span class="token operator">=</span> enumInstanceClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">EnumInstance</span> enumInstance <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>enumInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> enumInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>运行发现,找不到无参构造，这是怎么回事呢？</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NoSuchMethodException</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>newstudy<span class="token punctuation">.</span>design<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>creational<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>EnumInstance</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Class</span><span class="token punctuation">.</span><span class="token function">getConstructor0</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">3082</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2178</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>newstudy<span class="token punctuation">.</span>design<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>creational<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>SingletonTest</span><span class="token punctuation">.</span><span class="token function">test7</span><span class="token punctuation">(</span><span class="token class-name">SingletonTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">135</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="反编译-jad-查看-class-文件"><a href="#反编译-jad-查看-class-文件" class="header-anchor">#</a> 反编译 - jad 查看 class 文件</h2> <p>需要看下编译后的 class 文件，idea 自带的可以查看，但是我发现并没有编译后的任何迹象，不知道是为什么。</p> <p>那么使用 http://jd.benow.ca/ （jd-gui) 来查看编译后的 class 文件。会发现和 idea 中查看到的文件内容一模一样</p> <p>https://varaneckas.com/jad/ 使用该 jad ，是一个命令行工具。Windows 版本解压后，就是一个 jad.exe ，配置好环境变量。找到 idea 生成的 class 文件。运行以下命令</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>jad <span class="token class-name">EnumInstance</span><span class="token punctuation">.</span><span class="token keyword">class</span>

就会生成 <span class="token class-name">EnumInstance</span><span class="token punctuation">.</span>jad 文件。使用记事本等文本编辑器打开即可查看
在 <span class="token class-name">Windows10</span> 中配置了环境变量，暂时未生效，只能暂时进入该软件的目录中运行了
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>生成的文件内容如下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.</span>
<span class="token comment">// Jad home page: http://www.kpdus.com/jad.html</span>
<span class="token comment">// Decompiler options: packimports(3)</span>
<span class="token comment">// Source File Name:   EnumInstance.java</span>

<span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>newstudy<span class="token punctuation">.</span>design<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>creational<span class="token punctuation">.</span>singleton</span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">EnumInstance</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">EnumInstance</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>$VALUES<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">EnumInstance</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">EnumInstance</span><span class="token punctuation">)</span><span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>cn<span class="token operator">/</span>mrcode<span class="token operator">/</span>newstudy<span class="token operator">/</span>design<span class="token operator">/</span>pattern<span class="token operator">/</span>creational<span class="token operator">/</span>singleton<span class="token operator">/</span><span class="token class-name">EnumInstance</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">EnumInstance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">EnumInstance</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> data<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">EnumInstance</span> $VALUES<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span>
    <span class="token punctuation">{</span>
        INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">(</span><span class="token string">&quot;INSTANCE&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        $VALUES <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
            INSTANCE
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>通过以上内容可以总结出：</p> <ol><li>INSTANCE 变量是  static final 修饰的</li> <li><code>private EnumInstance(String s, int i)</code> 私有化的参数构造方法</li> <li>使用静态代码块来构造枚举对象实例</li></ol> <p>这里就真相了，反射的时候使用无参构造，报错找不到方法。</p> <h2 id="枚举单例模式续"><a href="#枚举单例模式续" class="header-anchor">#</a> 枚举单例模式续</h2> <p>那么这里使用有参的继续下去；</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span> <span class="token punctuation">{</span>
    <span class="token class-name">EnumInstance</span> instance <span class="token operator">=</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnumInstance</span><span class="token punctuation">&gt;</span></span> enumInstanceClass <span class="token operator">=</span> <span class="token class-name">EnumInstance</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnumInstance</span><span class="token punctuation">&gt;</span></span> declaredConstructor <span class="token operator">=</span> enumInstanceClass<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    declaredConstructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里还是根据 jad 里面的内容来传参数</span>
    <span class="token class-name">EnumInstance</span> enumInstance <span class="token operator">=</span> declaredConstructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">&quot;INSTANCE&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>enumInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> enumInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>结果发现还是不行,报错信息明确的说明了 不能通过反射创建枚举对象</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalArgumentException</span><span class="token operator">:</span> <span class="token class-name">Cannot</span> reflectively create <span class="token keyword">enum</span> objects

	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Constructor</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Constructor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">416</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">cn<span class="token punctuation">.</span>mrcode<span class="token punctuation">.</span>newstudy<span class="token punctuation">.</span>design<span class="token punctuation">.</span>pattern<span class="token punctuation">.</span>creational<span class="token punctuation">.</span>singleton<span class="token punctuation">.</span></span>SingletonTest</span><span class="token punctuation">.</span><span class="token function">test7</span><span class="token punctuation">(</span><span class="token class-name">SingletonTest</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">137</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>跟源码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Object</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> initargs<span class="token punctuation">)</span>
       <span class="token keyword">throws</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span>
              <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span>
   <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>override<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Reflection</span><span class="token punctuation">.</span><span class="token function">quickCheckMemberAccess</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> caller <span class="token operator">=</span> <span class="token class-name">Reflection</span><span class="token punctuation">.</span><span class="token function">getCallerClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token function">checkAccess</span><span class="token punctuation">(</span>caller<span class="token punctuation">,</span> clazz<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> modifiers<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
       <span class="token comment">// 进行了检查，枚举类型直接异常了</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span>ENUM<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot reflectively create enum objects&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="枚举类小结"><a href="#枚举类小结" class="header-anchor">#</a> 枚举类小结</h3> <ol><li>INSTANCE 变量是  static final 修饰的</li> <li><code>private EnumInstance(String s, int i)</code> 私有化的参数构造方法</li> <li>使用静态代码块来构造枚举对象实例</li> <li>序列化和反序列化是由序列化相关的类保证的</li> <li>反射攻击是由反射相关类保证的，而它自己不保证这些</li></ol> <blockquote><p>由于本文篇幅很大了，下一章节继续</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/note-book/edit/master/docs/imocc/design_pattern/08_singleton/singleton.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024-07-01 01:54:25</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-book/imocc/design_pattern/07_builder/builder.html" class="prev">
        建造者模式
      </a></span> <span class="next"><a href="/note-book/imocc/design_pattern/08_singleton/singleton2.html">
        单例模式2
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/note-book/assets/js/app.59b42468.js" defer></script><script src="/note-book/assets/js/7.a393a8e7.js" defer></script><script src="/note-book/assets/js/48.0d24adba.js" defer></script><script src="/note-book/assets/js/104.308420f7.js" defer></script>
  </body>
</html>
